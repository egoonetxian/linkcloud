<!DOCTYPE html><html><head><title>怎样在OSS中使用带IP限制的访问控制</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style></style></head><body><div id='preview-contents' class='note-content'>
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-1" class="wmd-preview-section preview-content">

</div><div id="wmd-preview-section-39" class="wmd-preview-section preview-content">

<h3 id="怎样再oss中使用带ip限制的访问控制">怎样在OSS中使用带IP限制的访问控制</h3>

</div><div id="wmd-preview-section-80" class="wmd-preview-section preview-content">

<h4 id="示例一在-allow-授权中增加ip限制">示例一：在 Allow 授权中增加IP限制</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;允许通过 42.120.88.0/24 ,  42.120.66.0/24 两个IP段读取myphotos中的信息;</p>

<pre class="prettyprint hljs-dark"><code class="hljs json"><span class="hljs-comment line-number">1.</span>{<br><span class="hljs-comment line-number">2.</span>"<span class="hljs-attribute">Version</span>": <span class="hljs-value"><span class="hljs-string">"1"</span></span>,<br><span class="hljs-comment line-number">3.</span>"<span class="hljs-attribute">Statement</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">4.</span>    {<br><span class="hljs-comment line-number">5.</span>        "<span class="hljs-attribute">Sid</span>": <span class="hljs-value"><span class="hljs-string">"允许列出所有Bucket"</span></span>,<br><span class="hljs-comment line-number">6.</span>        "<span class="hljs-attribute">Effect</span>": <span class="hljs-value"><span class="hljs-string">"Allow"</span></span>,<br><span class="hljs-comment line-number">7.</span>        "<span class="hljs-attribute">Action</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">8.</span>            <span class="hljs-string">"oss:ListBuckets"</span><br><span class="hljs-comment line-number">9.</span>        ]</span>,<br><span class="hljs-comment line-number">10.</span>        "<span class="hljs-attribute">Resource</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">11.</span>            <span class="hljs-string">"acs:oss:*:*:*"</span><br><span class="hljs-comment line-number">12.</span>        ]<br><span class="hljs-comment line-number">13.</span>    </span>},<br><span class="hljs-comment line-number">14.</span>    {<br><span class="hljs-comment line-number">15.</span>        "<span class="hljs-attribute">Sid</span>": <span class="hljs-value"><span class="hljs-string">"允许获取myphotos中的信息, 访问源必须在允许的IP段中"</span></span>,<br><span class="hljs-comment line-number">16.</span>        "<span class="hljs-attribute">Effect</span>": <span class="hljs-value"><span class="hljs-string">"Allow"</span></span>,<br><span class="hljs-comment line-number">17.</span>        "<span class="hljs-attribute">Action</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">18.</span>            <span class="hljs-string">"oss:ListObjects"</span>,<br><span class="hljs-comment line-number">19.</span>            <span class="hljs-string">"oss:GetObject"</span><br><span class="hljs-comment line-number">20.</span>        ]</span>,<br><span class="hljs-comment line-number">21.</span>        "<span class="hljs-attribute">Resource</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">22.</span>            <span class="hljs-string">"acs:oss:*:*:myphotos"</span>,<br><span class="hljs-comment line-number">23.</span>            <span class="hljs-string">"acs:oss:*:*:myphotos/*"</span><br><span class="hljs-comment line-number">24.</span>        ]</span>,<br><span class="hljs-comment line-number">25.</span>        "<span class="hljs-attribute">Condition</span>":<span class="hljs-value">{<br><span class="hljs-comment line-number">26.</span>            "<span class="hljs-attribute">IpAddress</span>": <span class="hljs-value">{<br><span class="hljs-comment line-number">27.</span>                "<span class="hljs-attribute">acs:SourceIp</span>": <span class="hljs-value">[<span class="hljs-string">"42.120.88.0/24"</span>, <span class="hljs-string">"42.120.66.0/24"</span>]<br><span class="hljs-comment line-number">28.</span>            </span>}<br><span class="hljs-comment line-number">29.</span>        </span>}<br><span class="hljs-comment line-number">30.</span>    </span>}<br><span class="hljs-comment line-number">31.</span>]<br><span class="hljs-comment line-number">32.</span></span>}<br></code></pre>

</div><div id="wmd-preview-section-225" class="wmd-preview-section preview-content">

<h4 id="示例2-在-deny-授权中增加ip限制">示例2: 在 Deny 授权中增加IP限制</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果源IP不在 42.120.88.0/24 中则禁止对OSS执行任何操作；</p>

<pre class="prettyprint hljs-dark"><code class="hljs json"><span class="hljs-comment line-number">1.</span>{<br><span class="hljs-comment line-number">2.</span>"<span class="hljs-attribute">Version</span>": <span class="hljs-value"><span class="hljs-string">"1"</span></span>,<br><span class="hljs-comment line-number">3.</span>"<span class="hljs-attribute">Statement</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">4.</span>    {<br><span class="hljs-comment line-number">5.</span>        "<span class="hljs-attribute">Sid</span>": <span class="hljs-value"><span class="hljs-string">"允许列出所有Bucket"</span></span>,<br><span class="hljs-comment line-number">6.</span>        "<span class="hljs-attribute">Effect</span>": <span class="hljs-value"><span class="hljs-string">"Allow"</span></span>,<br><span class="hljs-comment line-number">7.</span>        "<span class="hljs-attribute">Action</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">8.</span>            <span class="hljs-string">"oss:ListBuckets"</span><br><span class="hljs-comment line-number">9.</span>        ]</span>,<br><span class="hljs-comment line-number">10.</span>        "<span class="hljs-attribute">Resource</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">11.</span>            <span class="hljs-string">"acs:oss:*:*:*"</span><br><span class="hljs-comment line-number">12.</span>        ]<br><span class="hljs-comment line-number">13.</span>    </span>},<br><span class="hljs-comment line-number">14.</span>    {<br><span class="hljs-comment line-number">15.</span>        "<span class="hljs-attribute">Sid</span>": <span class="hljs-value"><span class="hljs-string">"允许获取myphotos中的信息"</span></span>,<br><span class="hljs-comment line-number">16.</span>        "<span class="hljs-attribute">Effect</span>": <span class="hljs-value"><span class="hljs-string">"Allow"</span></span>,<br><span class="hljs-comment line-number">17.</span>        "<span class="hljs-attribute">Action</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">18.</span>            <span class="hljs-string">"oss:ListObjects"</span>,<br><span class="hljs-comment line-number">19.</span>            <span class="hljs-string">"oss:GetObject"</span><br><span class="hljs-comment line-number">20.</span>        ]</span>,<br><span class="hljs-comment line-number">21.</span>        "<span class="hljs-attribute">Resource</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">22.</span>            <span class="hljs-string">"acs:oss:*:*:myphotos"</span>,<br><span class="hljs-comment line-number">23.</span>            <span class="hljs-string">"acs:oss:*:*:myphotos/*"</span><br><span class="hljs-comment line-number">24.</span>        ]<br><span class="hljs-comment line-number">25.</span>    </span>},<br><span class="hljs-comment line-number">26.</span>    {<br><span class="hljs-comment line-number">27.</span>        "<span class="hljs-attribute">Sid</span>": <span class="hljs-value"><span class="hljs-string">"禁止从42.120.88.0/24以外访问OSS"</span></span>,<br><span class="hljs-comment line-number">28.</span>        "<span class="hljs-attribute">Effect</span>": <span class="hljs-value"><span class="hljs-string">"Deny"</span></span>,<br><span class="hljs-comment line-number">29.</span>        "<span class="hljs-attribute">Action</span>": <span class="hljs-value"><span class="hljs-string">"oss:*"</span></span>,<br><span class="hljs-comment line-number">30.</span>        "<span class="hljs-attribute">Resource</span>": <span class="hljs-value">[<br><span class="hljs-comment line-number">31.</span>            <span class="hljs-string">"acs:oss:*:*:*"</span><br><span class="hljs-comment line-number">32.</span>        ]</span>,<br><span class="hljs-comment line-number">33.</span>        "<span class="hljs-attribute">Condition</span>":<span class="hljs-value">{<br><span class="hljs-comment line-number">34.</span>            "<span class="hljs-attribute">NotIpAddress</span>": <span class="hljs-value">{<br><span class="hljs-comment line-number">35.</span>                "<span class="hljs-attribute">acs:SourceIp</span>": <span class="hljs-value">[<span class="hljs-string">"42.120.88.0/24"</span>]<br><span class="hljs-comment line-number">36.</span>            </span>}<br><span class="hljs-comment line-number">37.</span>        </span>}<br><span class="hljs-comment line-number">38.</span>    </span>}<br><span class="hljs-comment line-number">39.</span>]<br><span class="hljs-comment line-number">40.</span></span>}<br></code></pre>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注意：因为Policy的鉴权规则是Deny优先(即如果用户的访问操作命中任意一条Deny规则， 
则禁止访问)，所以访问者从42.120.88.0/24以外的IP地址访问myphotos中的内容时， 
OSS服务会报没有权限。</p></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div></body></html>
